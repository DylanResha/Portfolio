; Dylan Resha	
; 10/30/2020
; Asignment 7 surprise
;For this assignment you are to be a data investigator.  That is, you will be given some data, and will be assigned to find the hidden message within.  Following the decipher rules below, you should be able to figure out what the surprise is.

SECTION .data
;;surprise

surprise: db 46,47,117,49,50,51,121,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,122,123,124,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,118,50,120,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,122,123,124,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,116,117,118,87,120,121,122,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,111,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,118,50,120,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,110,106,112,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,117,49,50,51,121,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,109,121,111,130,113,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,108,109,110,127,112,119,114,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,107,108,125,110,111,107,124,114,115,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,106,107,126,127,110,111,112,108,114,115,116,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,105,112,107,108,109,126,111,112,113,132,126,116,117,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,104,105,106,107,114,109,110,111,112,108,114,115,132,117,118,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,103,99,105,117,107,108,109,110,111,112,113,114,115,132,117,118,119,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,102,103,104,105,106,107,108,109,110,111,112,131,132,115,116,117,118,119,120,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,101,120,103,104,105,101,107,108,109,121,111,112,108,114,115,132,117,118,125,120,121,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,100,101,102,119,104,105,106,125,108,109,110,127,112,113,114,115,116,117,129,119,120,116,122,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,99,106,101,102,103,110,105,106,107,108,109,110,111,112,113,114,115,122,117,118,119,120,116,122,123,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,98,99,100,101,102,114,104,105,106,107,108,109,126,111,112,113,109,115,116,117,134,119,120,139,122,123,124,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,97,98,99,100,96,102,121,104,105,106,102,108,109,110,111,130,131,114,115,116,117,118,119,120,121,122,129,124,125,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,96,97,98,99,116,96,102,103,104,105,106,107,108,104,110,111,112,124,114,115,116,117,118,119,136,121,122,123,124,125,126,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,95,96,97,98,99,100,107,102,103,104,105,106,113,108,109,110,111,112,113,114,115,116,123,118,119,120,121,133,123,124,125,126,127,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,94,95,96,97,98,105,100,101,102,121,104,105,122,107,119,109,110,111,112,108,114,115,116,117,118,119,138,121,122,123,124,125,126,127,128,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,93,94,95,96,113,98,99,118,101,102,103,120,105,106,107,108,109,110,111,112,131,114,115,132,117,118,119,120,139,122,123,119,125,126,133,128,129,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,92,93,89,95,112,97,98,99,100,101,102,103,104,111,106,107,108,104,110,111,112,113,130,115,116,117,118,114,120,121,133,123,124,131,126,127,139,129,130,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,122,123,124,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,122,123,124,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125

surpLen: EQU ($-surprise)

; Clear Screen control characters 
cls	db	1bh, '[2J' 

; Set cursor position control characters
pos	db	1bh, '[' 
row	db	'00'
	db	';'
col	db	'00'
	db	'H'

nl db 0xA, 0xD
nlLen equ $-nl

; Data structure for the sleep function - seconds, nanoseconds
sec	dd	1,0

SECTION .text
global _main, _sleep, _setCursor
_main:

	;;;;;  Clear the screen
	mov	eax,4
	mov	ebx,1
	mov 	ecx,cls
	mov	edx,4
	int 	80h

;;;;  call _setcursor   pass ah=row, al=col
	mov	ah,50
	mov	al,0
	call	_setCursor

;;;; 	print message
	
	mov	esi, surprise
	mov	edi, surpLen 
	mov	eax, 1 ;; a counter that denotes which coloumn we are on
;;;; loop through and print chars
print:
	mov	edx, 1
	mov	ecx, [esi]
	
	sub	ecx, eax ;; subtract coloumn from ascii value
;;;; save eax and ecx values while we print
    push 	eax
    push	ecx
;;;; print character to screen
        mov 	ecx, esp
        mov     eax,4
        mov     ebx,1
        int     80h
;;;; retrieve saved eax and ecx values
    pop		ecx
    pop		eax
;;;; compares a held eax value to force 80 chars per line
	cmp eax, 80
	jne false
true:
 mov eax, 1
;;;; save eax and ecx values
 push eax
 push ecx
;;;; print a newline
  mov edx, nlLen
  mov ecx, nl
  mov ebx, 1
  mov eax, 4
  int 80h
;;;; retrieve saved eax and ecx
 pop ecx 
 pop eax
;;;; jump to after if so false isnt also ran
jmp afterif

false:
;;;; increment our eax value
 inc eax
afterif:
;;;; increment esi to point towards next character
	add	esi, 1
	dec	edi
;;;; loop back to print as long as edi doesnt equal 0, which would denote end of the data
jnz print

;;;;	sleep a second
	call	_sleep

; Normal termination code
	mov eax, 1
	mov ebx, 0
	int 80h

;. _setcursor expects AH = row, AL = col
;  Only works for 1 or 2 digit numbers.
_setCursor:
	pusha
;;; save original to get col later
	push	eax
;;;;;; process row
	shr	ax,8	;; shift row to right
	mov	bl,10
	div	bl	;; puts ax/10 in al, remainder in ah
	add	ah,'0'
	add	al,'0'
	mov	BYTE [row],al
	mov	BYTE [row+1],ah
;;;; process col
	pop	eax	;; restore original parms
	and	ax,0FFh ;; erase row, leave col
	mov	bl,10
	div	bl	;; puts ax/10 in al, remainder in ah
	add	ah,'0'
	add	al,'0'
	mov	BYTE [col],al
	mov	BYTE [col+1],ah

	;;;;; now print the set cursor codes
	mov	eax,4
	mov	ebx,1
	mov 	ecx,pos
	mov	edx,8
	int 	80h

	popa
	ret

;;;;; sleep requests sec,nanoseconds pause
_sleep:
	pusha
	mov	eax,162
	mov	ebx,sec
	mov	ecx,0
	int	80h
	popa
	ret











